<!DOCTYPE html>
<html>
<head>
  <title>4uFinder Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family:Arial; margin:0; background:#f4f4f4; }
    header { background:#131921; color:white; padding:15px 20px; display:flex; justify-content:space-between; align-items:center; }
    header h1 { margin:0; font-size:22px; }
    nav { background:#222; display:flex; flex-wrap:wrap; gap:10px; padding:10px; }
    nav button { padding:10px; background:#ff9900; border:none; cursor:pointer; color:#fff; border-radius:4px; }
    section { padding:20px; display:none; }
    section.active { display:block; }
    input, select, button { padding:10px; margin:5px 0; width:100%; border-radius:4px; }
    .card { background:#fff; padding:15px; margin:10px 0; border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
    .del { background:red; color:white; }
    h2 { margin-top:0; }
    hr { margin:20px 0; }
  </style>
</head>
<body>

<header>
  <h1>4uFinder Admin Panel</h1>
  <button onclick="logout()">Logout</button>
</header>

<nav>
  <button onclick="showSection('dashboard')">Dashboard</button>
  <button onclick="showSection('websiteSettings')">Website Settings</button>
  <button onclick="showSection('shopSettings')">Shop Settings</button>
  <button onclick="showSection('productsSection')">Product Management</button>
  <button onclick="showSection('ordersSection')">Order Management</button>
  <button onclick="showSection('slidersSection')">Manage Sliders</button>
  <button onclick="showSection('servicesSection')">Services</button>
  <button onclick="showSection('customersSection')">Registered Customers</button>
</nav>

<!-- DASHBOARD -->
<section id="dashboard" class="active">
  <h2>ğŸ“Š Admin Dashboard</h2>
  <p>Welcome Admin ğŸ‘‹</p>
  <p>Overview stats and quick links here.</p>
</section>

<!-- WEBSITE SETTINGS -->
<section id="websiteSettings">
  <h2>ğŸŒ Website Settings</h2>
  <input placeholder="Website Name">
  <input placeholder="Logo URL">
  <input placeholder="Contact Email">
  <button>Save Settings</button>
</section>

<!-- SHOP SETTINGS -->
<section id="shopSettings">
  <h2>ğŸª Shop Settings</h2>
  <input placeholder="Currency">
  <input placeholder="Tax Rate">
  <input placeholder="Shipping Options">
  <button>Save Shop Settings</button>
</section>

<!-- PRODUCT MANAGEMENT -->
<section id="productsSection">
  <h2>ğŸ›  Product Management</h2>
  <input id="id" placeholder="Product ID">
  <input id="name" placeholder="Product Name">
  <input id="price" placeholder="Price">
  <input type="file" id="imageFile" accept="image/*">
  <input id="category" placeholder="Category">
  <button onclick="addProduct()">â• Add / Update Product</button>

  <hr>
  <h3>ğŸ“¦ All Products</h3>
  <div id="products"></div>

  <hr>
  <h3>â­ Featured Products</h3>
  <select id="featuredSelect"><option value="">-- Select Product --</option></select>
  <button onclick="addFeatured()">â• Add to Featured</button>
  <div id="featuredProducts"></div>
</section>

<!-- ORDER MANAGEMENT -->
<section id="ordersSection">
  <h2>ğŸ§¾ Order Management</h2>
  <div id="ordersList"></div>
</section>

<!-- MANAGE SLIDERS -->
<section id="slidersSection">
  <h2>ğŸ Manage Sliders</h2>
  <input placeholder="Slider Image URL">
  <input placeholder="Slider Title">
  <button>Add Slider</button>
  <div id="sliderList"></div>
</section>

<!-- SERVICES -->
<section id="servicesSection">
  <h2>ğŸ› Services</h2>
  <input placeholder="Service Name">
  <input placeholder="Service Description">
  <button>Add Service</button>
  <div id="serviceList"></div>
</section>

<!-- REGISTERED CUSTOMERS -->
<section id="customersSection">
  <h2>ğŸ‘¥ Registered Customers</h2>
  <div id="customersList"></div>
</section>

<script>
const API_PRODUCTS = "https://sheetdb.io/api/v1/zq8bztk2qn6kx"; // Products SheetDB
const API_ORDERS = "https://sheetdb.io/api/v1/YOUR_ORDERS_ID";   // Orders SheetDB
const API_CUSTOMERS = "https://sheetdb.io/api/v1/YOUR_CUSTOMERS_ID"; // Customers SheetDB
const CLOUD_NAME = "dxuxsa5bg";
const UPLOAD_PRESET = "cludes7u";

// SECURITY
if(localStorage.getItem("admin") !== "true") location.href="admin-login.html";

function logout() {
  localStorage.removeItem("admin");
  window.location.href="admin-login.html";
}

function showSection(id){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

// ---------------- PRODUCTS ----------------
let featuredProducts = [];

async function loadProducts() {
  const res = await fetch(API_PRODUCTS);
  const data = await res.json();
  let html = "";
  const select = document.getElementById("featuredSelect");
  select.innerHTML = `<option value="">-- Select Product --</option>`;
  data.forEach(p=>{
    html+=`<div class="card"><b>${p.name}</b> ($${p.price})<br>${p.category}<br><button class="del" onclick="deleteProduct('${p.id}')">Delete</button></div>`;
    select.innerHTML+=`<option value="${p.id}">${p.name}</option>`;
  });
  document.getElementById("products").innerHTML=html;
}
async function addProduct() {
  let imageURL = document.getElementById("imageFile").dataset.old || "";

  const file = document.getElementById("imageFile").files[0];

  // Upload new image only if selected
  if (file) {
    let formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", UPLOAD_PRESET);

    const res = await fetch(
      `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,
      { method: "POST", body: formData }
    );

    const imgData = await res.json();
    imageURL = imgData.secure_url;
  }

  if (!name.value || !price.value || !category.value) {
    alert("Please fill all fields");
    return;
  }

  const product = {
    id: id.value || Date.now(),
    name: name.value,
    price: price.value,
    image: imageURL,
    category: category.value
  };

  const method = id.value ? "PUT" : "POST";
  const url = id.value
    ? `${API_PRODUCTS}/id/${id.value}`
    : API_PRODUCTS;

  await fetch(url, {
    method: method,
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ data: product })
  });

  alert("âœ… Product saved successfully!");

  // Clear form
  document.getElementById("id").value = "";
  document.getElementById("name").value = "";
  document.getElementById("price").value = "";
  document.getElementById("category").value = "";
  document.getElementById("imageFile").value = "";
  document.getElementById("imageFile").dataset.old = "";

  loadProducts();
}

function editProduct(id,name,price,image,category){
  document.getElementById("id").value = id;
  document.getElementById("name").value = name;
  document.getElementById("price").value = price;
  document.getElementById("category").value = category;

  // store old image if admin doesn't upload new one
  document.getElementById("imageFile").dataset.old = image;

  window.scrollTo({top:0,behavior:"smooth"});
}


// ---------------- FEATURED ----------------
function addFeatured(){
  const selectedID=document.getElementById("featuredSelect").value;
  if(!selectedID)return alert("Select a product first");
  if(!featuredProducts.includes(selectedID)) featuredProducts.push(selectedID);
  else return alert("Product is already featured");
  renderFeatured();
}

function removeFeatured(id){
  featuredProducts=featuredProducts.filter(f=>f!==id);
  renderFeatured();
}

async function renderFeatured(){
  let html="";
  const res=await fetch(API_PRODUCTS);
  const data=await res.json();
  featuredProducts.forEach(f=>{
    const p=data.find(prod=>prod.id===f);
    if(p) html+=`<div class="card"><b>${p.name}</b> ($${p.price})<br>${p.category}<br><button class="del" onclick="removeFeatured('${p.id}')">Remove</button></div>`;
  });
  document.getElementById("featuredProducts").innerHTML=html;
}

// ---------------- ORDERS ----------------
async function loadOrders() {
  const res = await fetch(API_ORDERS);
  const orders = await res.json();
  let html = "";
  orders.forEach(o => {
    html += `<div class="card">
      <b>Order ID:</b> ${o.id}<br>
      <b>Customer:</b> ${o.customerName} (${o.customerEmail})<br>
      <b>Products:</b> ${o.products}<br>
      <b>Total:</b> $${o.total}<br>
      <b>Status:</b> ${o.status}<br>
    </div>`;
  });
  document.getElementById("ordersList").innerHTML = html;
}
loadOrders();

// ---------------- CUSTOMERS ----------------
async function loadCustomers() {
  const res = await fetch(API_CUSTOMERS);
  const customers = await res.json();
  let html = "";
  customers.forEach(c => {
    html += `<div class="card">
      <b>${c.name}</b> (${c.email})<br>
      Registered: ${c.registeredDate || 'N/A'}
    </div>`;
  });
  document.getElementById("customersList").innerHTML = html;
}
loadCustomers();

</script>

</body>
</html>
