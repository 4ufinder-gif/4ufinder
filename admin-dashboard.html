<!DOCTYPE html>
<html>
<head>
<title>4uFinder Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family:Arial; padding:20px; background:#f4f4f4; }
input, button, select { padding:10px; margin:5px 0; width:100%; }
.card { background:#fff; padding:15px; margin:10px 0; border-radius:6px; }
button { background:#ff9900; border:none; cursor:pointer; }
.del { background:red; color:white; }
</style>
</head>

<body>

<h1>4uFinder Admin Dashboard</h1>
<p>Welcome Admin üëã</p>
<button onclick="logout()">Logout</button>

<hr>
<h2>üõ† Products</h2>

<!-- ADD / UPDATE PRODUCT -->
<input id="id" placeholder="Product ID">
<input id="name" placeholder="Product Name">
<input id="price" placeholder="Price">
<input type="file" id="imageFile" accept="image/*">
<input id="category" placeholder="Category">
<button onclick="addProduct()">‚ûï Add / Update Product</button>

<hr>
<h3>üì¶ All Products</h3>
<div id="products"></div>

<hr>
<h2>‚≠ê Featured Products</h2>
<select id="featuredSelect">
  <option value="">-- Select Product --</option>
</select>
<button onclick="addFeatured()">‚ûï Add to Featured</button>
<div id="featuredProducts"></div>

<script>
const API = "https://sheetdb.io/api/v1/zq8bztk2qn6kx"; // CHANGE TO YOUR SheetDB
const CLOUD_NAME = "dxuxsa5bg";
const UPLOAD_PRESET = "cludes7u";

// SECURITY
if (localStorage.getItem("admin") !== "true") {
  location.href = "admin-login.html";
}

// LOGOUT
function logout() {
  localStorage.removeItem("admin");
  window.location.href = "admin-login.html";
}

// ---------------- PRODUCTS ----------------
async function loadProducts() {
  const res = await fetch(API);
  const data = await res.json();
  let html = "";
  const select = document.getElementById("featuredSelect");
  select.innerHTML = `<option value="">-- Select Product --</option>`;
  data.forEach(p => {
    html += `
      <div class="card">
        <b>${p.name}</b> ($${p.price})<br>
        ${p.category}<br>
        <button class="del" onclick="deleteProduct('${p.id}')">Delete</button>
      </div>
    `;
    select.innerHTML += `<option value="${p.id}">${p.name}</option>`;
  });
  document.getElementById("products").innerHTML = html;
}
loadProducts();

async function addProduct() {
  const file = document.getElementById("imageFile").files[0];
  if (!file) return alert("Select an image");

  let formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", UPLOAD_PRESET);

  let res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, { method: "POST", body: formData });
  let imgData = await res.json();

  await fetch(API, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ data: [{ 
      id: id.value, 
      name: name.value, 
      price: price.value, 
      image: imgData.secure_url, 
      category: category.value 
    }]})
  });

  alert("Product added!");
  loadProducts();
}

function deleteProduct(id) {
  fetch(`${API}/id/${id}`, { method: "DELETE" })
    .then(() => loadProducts());
}

// ---------------- FEATURED ----------------
let featuredProducts = [];

function addFeatured() {
  const selectedID = document.getElementById("featuredSelect").value;
  if (!selectedID) return alert("Select a product first");
  if (!featuredProducts.includes(selectedID)) {
    featuredProducts.push(selectedID);
  } else {
    return alert("Product is already featured");
  }
  renderFeatured();
}

function removeFeatured(id) {
  featuredProducts = featuredProducts.filter(f => f !== id);
  renderFeatured();
}

async function renderFeatured() {
  let html = "";
  const res = await fetch(API);
  const data = await res.json();
  featuredProducts.forEach(f => {
    const p = data.find(prod => prod.id === f);
    if (p) {
      html += `<div class="card">
        <b>${p.name}</b> ($${p.price})<br>
        ${p.category}<br>
        <button class="del" onclick="removeFeatured('${p.id}')">Remove</button>
      </div>`;
    }
  });
  document.getElementById("featuredProducts").innerHTML = html;
}
</script>

</body>
</html>
