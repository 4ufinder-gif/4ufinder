<div id="products"></div>

<script type="module">
import { onAuthChange, auth, getProducts, deleteProduct, updateProduct } from '../firebase.js';

onAuthChange(user=>{
  if(!user) window.location.href = "../login.html";
});

const productsDiv = document.getElementById("products");

async function loadProducts(){
  productsDiv.innerHTML = "";
  const snapshot = await getProducts();
  
  snapshot.forEach(doc=>{
    const data = doc.data();
    const div = document.createElement("div");
    
    div.innerHTML = `
      <h4>${data.name} - $${data.price}</h4>
      <p>${data.description}</p>
      <img src="${data.imageURL}" width="100">
      <button onclick="editProduct('${doc.id}', '${data.name}', '${data.description}', ${data.price}, '${data.imageURL}')">Edit</button>
      <button onclick="deleteProduct('${doc.id}').then(loadProducts)">Delete</button>
      <hr>
    `;
    
    productsDiv.appendChild(div);
  });
}

window.editProduct = (id, name, description, price, imageURL) => {
  const newName = prompt("Product Name:", name);
  if(!newName) return;

  const newDesc = prompt("Description:", description);
  if(newDesc === null) return;

  const newPrice = prompt("Price:", price);
  if(!newPrice) return;

  const newImage = prompt("Image URL:", imageURL);
  if(!newImage) return;

  updateProduct(id, {
    name: newName,
    description: newDesc,
    price: parseFloat(newPrice),
    imageURL: newImage
  }).then(()=>{
    alert("Product updated!");
    loadProducts();
  }).catch(err=>alert(err.message));
};

loadProducts();
</script>
